<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LatestRouteRecyclerViewAdapter.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">au.com.realestate.hometime.timetable.latestcomingroute</a> &gt; <span class="el_source">LatestRouteRecyclerViewAdapter.kt</span></div><h1>LatestRouteRecyclerViewAdapter.kt</h1><pre class="source lang-java linenums">package au.com.realestate.hometime.timetable.latestcomingroute

import android.view.LayoutInflater
import android.view.ViewGroup
import androidx.recyclerview.widget.RecyclerView
import au.com.realestate.domain.route.model.Route
import au.com.realestate.hometime.R
import au.com.realestate.hometime.common.uimodels.RouteHeader
import au.com.realestate.hometime.common.viewholders.RouteHeaderViewHolder
import au.com.realestate.hometime.common.viewholders.RouteItemViewHolder
import java.util.*

<span class="fc" id="L13">class LatestRouteRecyclerViewAdapter(</span>
    private val routeHeaderComparator: Comparator&lt;RouteHeader&gt;,
    private val routeComparator: Comparator&lt;Route&gt;
<span class="fc" id="L16">) : RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;() {</span>

    private sealed class ViewType {
<span class="fc" id="L19">        object Header : ViewType()</span>
<span class="fc" id="L20">        object Item : ViewType()</span>
    }

<span class="pc" id="L23">    var headerWithRoutesMap: Map&lt;RouteHeader, List&lt;Route&gt;&gt; = emptyMap()</span>
        set(value) {
<span class="fc" id="L25">            field = value</span>
<span class="fc" id="L26">            val sortedMap = value.toSortedMap(routeHeaderComparator)</span>
<span class="fc" id="L27">            typeViews = sortedMap</span>
<span class="fc" id="L28">                .map { map -&gt;</span>
<span class="fc" id="L29">                    map.value</span>
<span class="fc" id="L30">                        .sortedWith(routeComparator)</span>
<span class="fc" id="L31">                        .map { item -&gt; Pair&lt;ViewType, Any&gt;(ViewType.Item, item) }</span>
<span class="fc" id="L32">                        .toMutableList()</span>
<span class="fc" id="L33">                        .apply {</span>
                            // insert routeHeader to the beginning
<span class="fc" id="L35">                            add(0, Pair(ViewType.Header, map.key))</span>
<span class="fc" id="L36">                        }</span>
                }
<span class="fc" id="L38">                .flatten()</span>

<span class="fc" id="L40">            notifyDataSetChanged()</span>
<span class="fc" id="L41">        }</span>

    private lateinit var typeViews: List&lt;Pair&lt;ViewType, Any&gt;&gt;

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RecyclerView.ViewHolder {
<span class="fc" id="L46">        val view = LayoutInflater.from(parent.context).inflate(viewType, parent, false)</span>
<span class="pc bpc" id="L47" title="1 of 3 branches missed.">        return when (viewType) {</span>
<span class="fc" id="L48">            R.layout.header_route -&gt; RouteHeaderViewHolder(view)</span>
<span class="fc" id="L49">            R.layout.item_route -&gt; RouteItemViewHolder(view)</span>
<span class="nc" id="L50">            else -&gt; throw IllegalArgumentException(&quot;Unknown viewType $viewType&quot;)</span>
        }
    }

    override fun getItemCount(): Int {
<span class="fc" id="L55">        return typeViews.size</span>
    }

    override fun onBindViewHolder(holder: RecyclerView.ViewHolder, position: Int) {
<span class="pc bpc" id="L59" title="1 of 3 branches missed.">        when (getItemViewType(position)) {</span>
            R.layout.header_route -&gt; {
<span class="pc bpc" id="L61" title="1 of 2 branches missed.">                (holder as RouteHeaderViewHolder).bind(typeViews[position].second as RouteHeader)</span>
            }
            R.layout.item_route -&gt; {
<span class="pc bpc" id="L64" title="1 of 2 branches missed.">                (holder as RouteItemViewHolder).bind(typeViews[position].second as Route)</span>
            }
        }
<span class="fc" id="L67">    }</span>

    override fun getItemViewType(position: Int): Int {
<span class="fc" id="L70">        return when (typeViews[position].first) {</span>
<span class="fc bfc" id="L71" title="All 2 branches covered.">            is ViewType.Header -&gt; R.layout.header_route</span>
<span class="fc" id="L72">            is ViewType.Item -&gt; R.layout.item_route</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>